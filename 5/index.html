<!DOCTYPE html>
<html>
<head>
    <title>Project 5: Fun with Diffusion Models </title>
    <style>
        body {
            font-family: Georgia, Times New Roman, Arial, sans-serif;
            margin: 40px;
            padding: 0px;
            background-color: #f0f8ff;
        }

        .container {
            max-width: 800px;
            margin: 40px;
            padding: 40px;
            text-align: center;
        }

        .inline-image-left {
            float: left; /* or 'right' */
            margin: 0 15px 15px 0; /* Adds space around the image */
            width: 300px; /* Optional: Control image size */
            height: auto;
        }

        .inline-image-right {
            float: right;
            margin: 0 15px 15px 0; /* Adds space around the image */
            width: 300px; /* Optional: Control image size */
            height: auto;
        }
        

        .image-row {
            display: flex;
            justify-content: center; 
            gap: 0;
        }

        .image-row img {
            width: 200px;  
            height: auto;     
            object-fit: contain;
        }

        .big-row img {
            width: 400px; 
            height: 400px;    
            padding: 0;    
            margin: 0;    
            border: none;  
            gap: 0;
        }

        .mid-row img {
            width: 100px; 
            height: 100px;    
            padding: 0;    
            margin: 0;    
            border: none;  
            gap: 5;
        }

        .text-with-image {
            display: flex;
            align-items: center; /* Aligns image and text vertically */
            gap: 15px; /* Space between image and text */
        }

        .text-with-image-left {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 15px;
        }

        .text-with-image-left img {
            width: 300px;
            height: auto;
        }
        
        .text-with-image-right {
            display: flex;
            flex-direction: row-reverse;
            align-items: center;
            gap: 15px;
        }

        .text-with-image-right img {
            width: 200px; 
            height: auto;
        }
        
        
        .text-with-image img {
            width: 300px; /* Adjust size */
            height: auto;
        }
        
        figure {
            text-align: center;
        }
 
        .center-text {
            text-align: center; 
        }
        
    </style>
    
</head>
<body>
    <h1> Project 5: Fun with Diffusion Models </h1>
    <h2> by Maya Joiner </h2>

    
    <h2> Part 5A: The Power of Diffusion Models </h2>

    <p> AI art is becoming more and more common among short-form content, music videos, and of course, art. However, many might not understand how exactly these images are created. In this part of the project, I attempt to create different images and even optical illusions.  </p>
    <p> It's easy to "destroy" a clear image into white noise -- however, it's hard to reconstruct a real image from white noise. A more easy reconstruction process would be to reverse or undo the process of destroying an image, also known as "denoising" an image. </p>

  <h4> Prelims </h4>

  <p> For example, using HuggingFace's diffusion model package, we can create images using the prompts: </p>
    <div class="image-row big-row">
    <p><img src="media/num_inference_steps = 20 .png" /></p>
    </div>

  <p> These images were created using "inference steps" of 20. This means that the image was denoised 20 times. If we increase the number of denoising steps, we get a more "accurate" image (which looks more realistic and less AI-art looking). The drawback of increasing the denoising steps is that it takes longer. </p>

    <div class="image-row big-row">
    <p><img src="media/num_inference_steps = 100.png" /></p>
    </div>
    
    <p> The same prompts, but with <b> inference steps = 100 </b> </p>

    <div class="image-row big-row">
    <p><img src="media/num_inference = 50 step 1, 20 step 2.png" /></p>
    </div>
    
    <p> The same prompts, but with <b> inference steps = 50 </b> for step1, and <b> inference steps = 20 </b> for step2. </p>

    <p> Given this real campanile image: </p>

    <div class="image-row big-row">
    <p><img src="media/campanile.jpg" /></p>
    </div>

    <p> I perform the forward process, which is given by the equation: </p>
    <h5> sqrt(alpha) * image + sqrt(1-alpha) * epsilon </h5>
    <p> Where alpha represents a cumulative product of the amount of noise is removed each time, and epsilon represents a random value picked within a Normal distribution ~N(0, 1). I can try to blur the image to denoise it, but that doesn't work well. The best kernel size I found was k=7: </p>

    <div class="image-row big-row">
    <p><img src="media/campanile_250_500_750.png" /></p>
    <p><img src="media/1.2_denoised.png" /></p>
    </div>

    <p> Therefore, instead of simply blurring, I implement <b> one-step denoising </b>. The idea of one step denoising is that for different time steps, we estimate the amount of noise present in the noisy image. If we then subtract that estimated amount of noise from the noisy image, theoretically we should get a clean image. This works pretty well for small time steps (i.e. images that are not too noisy), but gets progressively worse as the image gets more noisy: </p>

    <div class="image-row big-row">
    <p><img src="media/1.3.png" /></p>
    </div>

    <p> To fix this issue, we denoise in many steps, also known as <b> iterative denoising </b>. In the image below, I compare iterative denoising with one-step denoising: </p>

    <div class="image-row big-row">
    <p><img src="media/1.4-1.png" /></p>
    <p><img src="media/1.4-2.png" /></p>
    </div>

    <p> These images were generated using i=10, but if I set i to 0, I can denoise random noise to make images based on a prompt (the prompt was "a high quality image"): </p>

    <div class="image-row mid-row">
    <p><img src="media/1.4-pic1.png" /></p>
    <p><img src="media/1.4-pic2.png" /></p>
    <p><img src="media/1.4-pic3.png" /></p>
    <p><img src="media/1.4-pic4.png" /></p>
    <p><img src="media/1.4-pic5.png" /></p>
    </div>

    <p> To improve the image quality even more, I use a technique called <b> Classifier-Free Guidance (CFG)</b>. The gist of this technique is that I blend a conditional image estimate (image with a prompt like "a high quality image") with an unconditional image estimate (image with no prompt) to create the final output. </p>

    <p> The equation for blending the two types of images is <b> u + gamma(c-u) </b>, where u is the unconditional noise estimate, c is the conditional noise estimate, and gamma is a constant that represents the strength of the CFG (a higher gamma value means the output will follow the conditional prompt more). </p>

    <p> Here are some images generated using CFG with a gamma value of 7: </p>
    <div class="image-row mid-row">
    <p><img src="media/1.6-pic1.png" /></p>
    <p><img src="media/1.6-pic2.png" /></p>
    <p><img src="media/1.6-pic3.png" /></p>
    <p><img src="media/1.6-pic4.png" /></p>
    <p><img src="media/1.6-pic5.png" /></p>
    </div>

    <h3> 1.7.0 </h3>

    <div class="image-row mid-row">
    <p><img src="media/1.7-pic1.png" /></p>
    <p><img src="media/1.7-pic2.png" /></p>
    <p><img src="media/1.7-pic3.png" /></p>
    <p><img src="media/1.7-pic4.png" /></p>
    <p><img src="media/1.7-pic5.png" /></p>
    <p><img src="media/1.7-pic6.png" /></p>
    </div>

    <figure>
    <p> Depending on our i_start value (noise level), the accuracy of the photo (how similar it is to the test image) differs. The higher i is, the more accurate the image becomes -- by i=20, we get a campanile: </p>
    </figure>

    <div class="image-row mid-row">
    <p><img src="media/1.7.0-pic1.png" /></p>
    <p><img src="media/1.7.0-pic2.png" /></p>
    <p><img src="media/1.7.0-pic3.png" /></p>
    <p><img src="media/1.7.0.pic4.png" /></p>
    <p><img src="media/1.7.0-pic5.png" /></p>
    <p><img src="media/1.7.0-pic6.png" /></p>
    <p><img src="media/dog.jpg" /></p>
    </div>

    <div class="image-row mid-row">
    <p><img src="media/1.7.0.0-pic1.png" /></p>
    <p><img src="media/1.7.0.0-pic2.png" /></p>
    <p><img src="media/1.7.0.0-pic3.png" /></p>
    <p><img src="media/1.7.0.0-pic4.png" /></p>
    <p><img src="media/1.7.0.0-pic5.png" /></p>
    <p><img src="media/1.7.0.0-pic6.png" /></p>  
    <p><img src="media/pokemon.png" /></p>
    </div>

    <h3> 1.7.1-1.7.2 </h3>
    <div class="image-row mid-row">
    <p><img src="media/1.7.1-pic1.png" /></p>
    <p><img src="media/1.7.1-pic2.png" /></p>
    <p><img src="media/1.7.1-pic3.png" /></p>
    <p><img src="media/1.7.1-pic4.png" /></p>
    <p><img src="media/1.7.1-pic5.png" /></p>
    <p><img src="media/1.7.1-pic6.png" /></p>
    <p><img src="media/1.7.1-strawberry.jpg" /></p>
    </div>

    <div class="image-row mid-row">    
    <p><img src="media/1.7.2-squid.png" /></p>
    <p><img src="media/1.7.2-squid-drawing.png" /></p>
    <p><img src="media/1.7.2-processed.png" /></p>    
    </div>

    <div class="image-row mid-row">    
    <p><img src="media/1.7.2-pic1.png" /></p>
    <p><img src="media/1.7.2-pic2.png" /></p>
    <p><img src="media/1.7.2-pic3.png" /></p>
    <p><img src="media/1.7.2-pic4.png" /></p>
    <p><img src="media/1.7.2-pic5.png" /></p>
    <p><img src="media/1.7.2-pic6.png" /></p>
    </div>

    <div class="image-row mid-row">    
    <p><img src="media/1.7.2.2-bird.jpg" /></p>
    <p><img src="media/1.7.2.2-bird-drawing.png" /></p>
    <p><img src="media/1.7.2.2-bird-processed.png" /></p>    
    </div>

    <div class="image-row mid-row">    
    <p><img src="media/1.7.2.2-pic1.png" /></p>
    <p><img src="media/1.7.2.2-pic2.png" /></p>
    <p><img src="media/1.7.2.2-pic3.png" /></p>
    <p><img src="media/1.7.2.2-pic4.png" /></p>
    <p><img src="media/1.7.2.2-pic5.png" /></p>
    <p><img src="media/1.7.2.2-pic6.png" /></p>
    </div>


    <h3> 1.7.3 </h3>
    <div class="image-row mid-row">    
    <p><img src="media/1.7.3.1-pic1.png" /></p>
    <p><img src="media/1.7.3.1-pic2.png" /></p>
    <p><img src="media/1.7.3.1-pic3.png" /></p>
    <p><img src="media/1.7.3.1-pic4.png" /></p>
    <p><img src="media/1.7.3.1-pic5.png" /></p>
    <p><img src="media/1.7.3.1-pic6.png" /></p>
    </div>

    <div class="image-row mid-row">    
    <p><img src="media/1.7.3.2-pic1.png" /></p>
    <p><img src="media/1.7.3.2-pic2.png" /></p>
    <p><img src="media/1.7.3.2-pic3.png" /></p>
    <p><img src="media/1.7.3.2-pic4.png" /></p>
    <p><img src="media/1.7.3.2-pic5.png" /></p>
    <p><img src="media/1.7.3.2-pic6.png" /></p>
    </div>

    <div class="image-row mid-row">    
    <p><img src="media/1.7.3.3-pic1.png" /></p>
    <p><img src="media/1.7.3.3-pic2.png" /></p>
    <p><img src="media/1.7.3.3-pic3.png" /></p>
    <p><img src="media/1.7.3.3-pic4.png" /></p>
    <p><img src="media/1.7.3.3-pic5.png" /></p>
    <p><img src="media/1.7.3.3-pic6.png" /></p>
    </div>

    <div class="image-row mid-row">    
    <p><img src="media/1.8-1.png" /></p>
    <p><img src="media/1.8-1-flip.png" /></p>
    </div>

    <div class="image-row mid-row">    
    <p><img src="media/1.8-2.png" /></p>
    <p><img src="media/1.8-2-flip.png" /></p>
    </div>

    <div class="image-row mid-row">    
    <p><img src="media/1.8-3.png" /></p>
    <p><img src="media/1.8-3-flip.png" /></p>
    </div>

    <div class="image-row mid-row">    
    <p><img src="media/1.8-4.png" /></p>
    <p><img src="media/1.8-4-flip.png" /></p>
    </div>

    <div class="image-row mid-row">    
    <p><img src="media/1.9-1.png" /></p>
    <p><img src="media/1.9-2.png" /></p>
    <p><img src="media/1.9-3.png" /></p>
    <p><img src="media/1.9-4.png" /></p>
    <p><img src="media/1.9-5.png" /></p>
    </div>
 
</body>
</html>
